<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro" name="simple_robot">

    <material name="dark_grey">
        <color rgba="0.2 0.2 0.2 1"/>
    </material>
    <material name="light_grey">
        <color rgba="0.8 0.8 0.8 0.8"/>
    </material>
    <material name="beige">
        <color rgba="0.76 0.76 0.7 1.0"/>
    </material>

    <link name="base_link"></link>

    <link name="robot_body">
        <visual>
            <orign xyz="0 0 0" rpy="0 0 0"/>
            <geometry>
                <box size="0.4 0.2 0.2"/>
            </geometry>
            <material name="beige"/>
        </visual>
        <collision>
            <orign xyz="0 0 0" rpy="0 0 0"/>
            <geometry>
                <box size="0.4 0.2 0.2"/>
            </geometry>
        </collision>
        <inertial>
            <orign xyz="0 0 0" rpy="0 0 0"/>
            <mass value="5"/>
            <inertia 
                ixx="0.03" ixy = "0" ixz = "0"
                iyy="0.083" iyz = "0"
                izz="0.083"
                />
        </inertial>
    </link>
    <joint name="base_to_body" type="fixed">
        <parent link="base_link"/>
        <child link="robot_body"/>
        <origin xyz="0 0 0.15" rpy="0 0 0"/>
    </joint>

    <link name="robot_up_plate"></link>
    <joint name="base_to_up_plate" type="fixed">
        <parent link="robot_body"/>
        <child link="robot_up_plate"/>
        <origin xyz="0 0 0.1" rpy="0 0 0"/>
    </joint>

    <link name="left_wheel">
        <visual>
            <origin xyz="0 0 0" rpy="0 1.570796327 0"/>
            <geometry>
                <cylinder length="0.05" radius="0.05"/>
            </geometry>
            <material name="dark_grey"/>
        </visual>
        <collision>
            <origin xyz="0 0 0" rpy="0 1.570796327 0"/>
            <geometry>
                <cylinder length="0.05" radius="0.05"/>
            </geometry>
        </collision>
        <inertial>
            <origin xyz="0 0 0" rpy="0 1.570796327 0"/>
            <mass value="0.2"/>
            <inertia
                ixx="0.00016" ixy = "0" ixz = "0"
                iyy="0.00016" iyz = "0"
                izz="0.00025"
                />
        </inertial>
    </link>
    <joint name="left_wheel_joint" type="continuous">
        <parent link="robot_up_plate"/>
        <child link="left_wheel"/>
        <origin xyz="-0.2 0.16 -0.2" rpy="0 0 1.570796327"/>
        <axis xyz="1 0 0"/>
    </joint>
    <transmission name="left_wheel_trans">
        <type>transmission_interface/SimpleTransmission</type>
        <joint name="left_wheel_joint">
            <hardwareInterface>VelocityJointInterface</hardwareInterface>
        </joint>
        <actuator name="left_wheel_actuator">
            <mechanicalReduction>1</mechanicalReduction>
        </actuator>
    </transmission>
    <gazebo reference="left_wheel">
        <mu1 value="1.0"/>
        <mu2 value="1.0"/>
    </gazebo>

    <link name="right_wheel">
        <visual>
            <origin xyz="0 0 0" rpy="0 1.570796327 0"/>
            <geometry>
                <cylinder length="0.05" radius="0.05"/>
            </geometry>
            <material name="dark_grey"/>
        </visual>
        <collision>
            <origin xyz="0 0 0" rpy="0 1.570796327 0"/>
            <geometry>
                <cylinder length="0.05" radius="0.05"/>
            </geometry>
        </collision>
        <inertial>
            <origin xyz="0 0 0" rpy="0 1.570796327 0"/>
            <mass value="0.2"/>
            <inertia
                ixx="0.00016" ixy = "0" ixz = "0"
                iyy="0.00016" iyz = "0"
                izz="0.00025"
                />
        </inertial>
    </link>
    <joint name="right_wheel_joint" type="continuous">
        <parent link="robot_up_plate"/>
        <child link="right_wheel"/>
        <origin xyz="-0.2 -0.16 -0.2" rpy="0 0 -1.570796327"/>
        <axis xyz="-1 0 0"/>
    </joint>
    <transmission name="right_wheel_trans">
        <type>transmission_interface/SimpleTransmission</type>
        <joint name="right_wheel_joint">
            <hardwareInterface>VelocityJointInterface</hardwareInterface>
        </joint>
        <actuator name="right_wheel_actuator">
            <mechanicalReduction>1</mechanicalReduction>
        </actuator>
    </transmission>
    <gazebo reference="right_wheel">
        <mu1 value="1.0"/>
        <mu2 value="1.0"/>
    </gazebo>

    <link name="front_caster">
        <visual>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <geometry>
                <sphere radius="0.025"/>
            </geometry>
            <material name="dark_grey"/>
        </visual>
        <collision>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <geometry>
                <sphere radius="0.025"/>
            </geometry>
        </collision>
        <inertial>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <mass value="0.05"/>
            <inertia
                ixx="0.0000125" ixy = "0" ixz = "0"
                iyy="0.0000125" iyz = "0"
                izz="0.0000125"
                />
        </inertial>
    </link>
    <joint name="base_to_front_caster" type="fixed">
        <parent link="robot_up_plate"/>
        <child link="front_caster"/>
        <origin xyz="0.18 0 -0.225" rpy="0 0 0"/>
    </joint>
    <gazebo reference="front_caster">
        <mu1 value="0.0"/>
        <mu2 value="0.0"/>
    </gazebo>

    <gazebo>
        <plugin name="differential_drive_controller" filename="libgazebo_ros_diff_drive.so">
            <alwaysOn>true</alwaysOn>
            <updateRate>20</updateRate>
            <leftJoint>left_wheel_joint</leftJoint>
            <rightJoint>right_wheel_joint</rightJoint>
            <wheelSeparation>0.32</wheelSeparation>
            <wheelDiameter>0.1</wheelDiameter>
            <torque>20</torque>
            <commandTopic>cmd_vel</commandTopic>
            <odometryTopic>odom</odometryTopic>
            <odometryFrame>odom</odometryFrame>
            <robotBaseFrame>base_link</robotBaseFrame>
            <legacyMode>false</legacyMode>
            <publishWheelTF>true</publishWheelTF>
            <publishTf>true</publishTf>
            <publishWheelJointState>false</publishWheelJointState>
        </plugin>
    </gazebo>

    <link name="lidar_link">
        <visual>
            <origin xzy="0 0 0" rpy="0 0 0"/>
            <geometry>
                <box size="0.01 0.01 0.01"/>
            </geometry>
        </visual>
        <collision>
            <origin xzy="0 0 0" rpy="0 0 0"/>
            <geometry>
                <box size="0.01 0.01 0.01"/>
            </geometry>
        </collision>
        <inertial>
            <mass value="1e-5"/>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <inertia ixx="1e-6" ixy="0" ixz="0" iyy="1e-6" iyz="0" izz="1e-6"/>
        </inertial>
    </link>
    <joint name="lidar_joint" type="fixed">
        <axis xyz="0 1 0"/>
        <origin xyz="0 0 0.005" rpy="0 0 0"/>
        <parent link="robot_up_plate"/>
        <child link="lidar_link"/>
    </joint>
    <gazebo reference="lidar_link">
    <sensor type="ray" name="lidar_sensor">
      <pose>0 0 0 0 0 0</pose>
      <visualize>false</visualize>
      <update_rate>40</update_rate>
      <ray>
        <scan>
          <horizontal>
            <samples>720</samples>
            <resolution>1</resolution>
            <min_angle>-1.570796</min_angle>
            <max_angle>1.570796</max_angle>
          </horizontal>
        </scan>
        <range>
          <min>0.05</min>
          <max>10.0</max>
          <resolution>0.01</resolution>
        </range>
        <noise>
          <type>gaussian</type>
          <mean>0.0</mean>
          <stddev>0.01</stddev>
        </noise>
      </ray>
      <plugin name="gazebo_ros_head_hokuyo_controller" filename="libgazebo_ros_laser.so">
        <topicName>/scan</topicName>
        <frameName>lidar_link</frameName>
      </plugin>
    </sensor>
  </gazebo>

</robot>
